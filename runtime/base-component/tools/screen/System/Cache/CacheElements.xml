<?xml version="1.0" encoding="UTF-8"?>
<!--
This is free and unencumbered software released into the public domain.
For specific language governing permissions and limitations refer to
the LICENSE.md file or http://unlicense.org
-->
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-1.5.xsd">

    <parameter name="cacheName" required="true"/>

    <transition name="clearCacheElement">
        <actions>
            <script>
                org.moqui.context.Cache theCache = ec.cache.getCache(cacheName)
                if (theCache.containsKey(key)) {
                    Object cacheValue = theCache.remove(key)
                    ec.message.addMessage("Cleared [${key}] from cache [${cacheName}] had value [${cacheValue}]")
                } else {
                    ec.message.addError("No entry with key [${key}] in cache [${cacheName}]")
                }
            </script>
        </actions>
        <default-response url="."/>
    </transition>

    <actions>
        <set field="pageSize" from="pageSize ?: 40"/>
        <set field="cacheElementList" from="ec.cache.getCache(cacheName)?.makeElementInfoList(orderByField?:'+key')"/>
        <script>StupidUtilities.paginateList("cacheElementList", null, context)</script>
    </actions>
    <widgets>
        <label text="Elements for Cache [${cacheName}]" type="h3"/>
        <label text="${totalSize &gt; displayLimit ? totalSize + ' elements, displaying first ' + displayLimit : ''}" display-if-empty="false"/>
        <form-list name="CacheElements" list="cacheElementList" skip-form="true">
            <field name="key">
                <header-field show-order-by="true"/>
                <default-field><display also-hidden="false"/></default-field>
            </field>
            <field name="value">
                <default-field><display text="${value != null &amp;&amp; value.length() > 200 ? value.substring(0, 200) : value}" also-hidden="false"/></default-field>
            </field>
            <field name="hitCount">
                <header-field title="Hits" show-order-by="true"/>
                <default-field><display also-hidden="false"/></default-field>
            </field>
            <field name="creationTime">
                <header-field title="Created" show-order-by="true"/>
                <default-field><display also-hidden="false"/></default-field>
            </field>
            <field name="lastUpdateTime">
                <header-field title="Last Update" show-order-by="true"/>
                <default-field><display also-hidden="false"/></default-field>
            </field>
            <field name="lastAccessTime">
                <header-field title="Last Access" show-order-by="true"/>
                <default-field><display also-hidden="false"/></default-field>
            </field>
            <field name="version">
                <header-field show-order-by="true"/>
                <default-field><display also-hidden="false"/></default-field>
            </field>
            <field name="clear">
                <default-field><link text="Clear" url="clearCacheElement" link-type="anchor"><parameter name="key"/></link></default-field>
            </field>
        </form-list>
    </widgets>
</screen>
